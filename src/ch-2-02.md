# 第二章 网站框架总体设计

## 一、领受任务

接到客户提供的开发文档和期望的效果图，谈好日期和要求等。由于是个人做网站，很多要求都是口头上的，而且是大致想法，并没有太多纸质文档。各种进展都是随着开发的进行慢慢协商修改的。效率不高。在开发后期，由于进度太慢，购买了别人已经成熟的产品，几乎宣告了本网站的失败。所幸提供了一些操作界面等方面的参考内容，接下来就是在明知几乎被抛弃的前提下，出于学习的目的，模仿别人已经成熟的界面，完善网站的内容。

### **任务的大致内容**

做人员在位状态动态管理系统。

+ 用户分为好几类，比如后台管理员、基层管理员、上层管理员、上层休假管理员一、上层休假管理员二等等。
+ 人员分为三大类和各种小类，比如甲类、乙类、丙类等等。
+ 人员状态分为十几类。
+ 人员动作分为好几种等等。
+ 随着开发的进展，对遇到的问题，再商讨任务内容。

## 二、任务分析

这是一个人员管理的网站，网上应当有很多相关的公开源码可供参考。
网站设计应当遵循以下原则：
+ 尽可能的使用已有源码，加快进度；
+ 应当仔细、仔细、再仔细的慎重考虑设计数据库表；
+ 前后端分开；
+ 操作界面首先简洁，其次再考虑响应速度；
+ 留有扩展功能的余地；
+ 考虑跟硬件的关系。

整体框架应该以人为主要考虑因素，管理者数量稀少，被管理者没有太多登录该网站的必要。应当实现管理者和被管理者的分开存储。
网站还要考虑跟硬件连接。整体框架如下图所示。



## 三、实现思路

### 1、选择开发环境

比较 **ASP.NET** 和 **PHP** (当然还有 **JAVA** )，限于本人爱好，显然 **PHP** （后来购买的别人已经成熟的产品，使用的是 **ASP.NET** ，有源码，造成了后期开发的极大不便）。本着“站在巨人肩膀”的原则，选择框架 *framework* ，可以加快开发速度。接触过 [Yii](https://github.com/yiisoft/yii) ，为了跟上时代，选择 [Yii 2](https://github.com/yiisoft/yii2) 的高级版本 *advanced*。
为了更快的开发，找个现成的源码加以改写，那就 [shi-yang](https://github.com/shi-yang) 的 [iisns](https://github.com/shi-yang/iisns/) 了。

### 2、搜集资料

首选[英文](http://www.yiiframework.com/doc-2.0/guide-index.html)，因为吃过中文翻译漏译的亏。按照教程来做，有个大致印象。

搜集的资料，暂时确定选择五本书以及若干源代码视频参考：

**书籍：**
+ 《The Definitive Guide to Yii 2.0》
知道 Yii 2.0 大概内容
+ 《Web Application Development with Yii 2 and PHP》
粗略的知道 Yii 2.0 的内容
+ 《Yii 2 for beginners》
了解要开发的一般流程
+ 《Learning Yii Test》
待读
+ 《Yii2 By Example》
查阅

**源码：**
+ https://github.com/shi-yang/iisns
+ https://github.com/michaelweixi/Yii2Blog

**视频：**
+ 魏曦系列视频 http://i.youku.com/weixistyle

以及编写[项目计划书](./appendix-c.md)。


### 3、总体构思

#### 3.1 搭建 Yii 2.0 开发环境和测试环境

现在已经完成开发环境搭建，测试环境由于个人精力有限，暂时不做。

#### 3.2 Yii 2.0 advanced 版本初始化，git 初始化

#### 3.3 开发网站的一般流程

1. 数据库设计
2. 用户登录实现
3. gii数据表生成
4. 其他功能实现
5. 辅助功能实现，比如上传文件等
6. 测试

#### 3.4 框架构思

前端显示页面如下图。

![框架图](../images/ch13-frontend.png)

+ 侧边栏主要是针对特定角色的人提供不同的菜单
+ 上面的一栏提供共同的信息，或者是侧边栏的重复
+ 主页面，显示主要内容。

#### 3.5 一个角色一个菜单

根据不同的用户制定不同的菜单项，主体结构是相同的。

#### 3.6 后台设计

+ 参考别人的后台形式
+ 后台的功能有哪些？

#### 3.7 测试

待定。时间不够，可能忽略。

#### 3.8 花90%的时间做剩下10%的工作

+ 优化，试运行

### 4、开发进度安排（现在发现，进度安排完全不靠谱 20160802）

最好在两个月内完成。

* 2015.11.01-2015.12.01 实现查阅资料文档和初步设计
* 2015.12.01-2016.01.01 草稿完成
其中：
  + 第一周 菜单的设计以及测试环境的搭建
  + 第二三周 菜单功能实现以及问题总结
  + 第四周 设计后台
  + 第五周 测试
* 2016.01.01- 待定

## 四、后期补充

### 1、（20160802）

网站开发已经跟计划完全脱节了。现在的状况是网站主要内容都实现了，但是在开始调试运行该网站的时候，发现 Excel 数据导入由于种种力不能及的问题卡住了，还有一些网络硬件的原因，致使网站迟迟不能部署。给购买别人的网站提供了很好的机会。现在存在的问题如下：
+ 如何操作门禁系统和车辆管理系统。
+ 如何调用门口的摄像头。
+ 如何实现别人网站的其他功能。

解决思路如下：
+ （偷懒型）整理文档，查阅门禁相关资料、播放视频相关资料；
+ （坚决执行型）联系网站的卖家，看看能否提供源码更多信息；
+ （可以进行型）完善本网站录入问题，实现 CSV 格式文件的导入，代替 Excel。

### 2、（20160829）

网站算是中止有两个月了，接下来何去何从。以撰写文档为主，修改发现的已知错误，开源代码。现计划如下：
+ 网站基本被废，所以要抓紧时间，尽快完善文档。
+ 网站算是完工，可以对整体框架进行反思。
+ 采用总分式对代码和构架进行解释。

思路：
+ 文档中，能出现截图的，尽快截图，解说详细。
+ 制定文档书写计划。
+ 整理代码。

文档书写计划：
+ 分功能介绍
+ 务必开源代码

### 3、（20160909）

为自己积累经验吧，打算如下处理网站。这个方法非常荒谬，姑且做着玩玩吧。
+ 使用虚拟机搭建网络服务器，在主机上开通 8000 端口。做法见后面介绍。
+ 给 MS SQL Server 备份数据。
+ 读取备份数据，并对格式进行修改。
+ 根据备份数据，修改代码使兼容。