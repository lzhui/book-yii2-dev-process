# 第二十五章 周末和战备的自动跳变

还没有完成的内容
+ 单位人数的实时更新。根据人员录入退伍等修改 （完成）
+ 人员显示的是本单位的军官、士官，还是全部人员？
+ 周末战备的定时互相修改（具体内容待定，暂时没有实现）
+ 人员按比例外出（具体内容待定，暂时没有实现）
+ 权限管理（暂时不加入）

## 给定一个日期和时间，自动提醒

### 功能分析

对于战备和周末这类事件，只要给定了日期，年月日时分秒，就可以根据
 `月日时分` 制定 `crontab` 计划，每年的这个时候都可以执行。

**注意事项**
+ 周末需要每周都设置日期时间，如果不设定，则自动下周这个时候执行
+ 周末有啥特殊的吗？功能待定。
+ 战备是只需要根据设定的日期自动修改即可。
+ 战备和周末的编号 `id` 在数据库表格中，分别为 `war-ready`, `weekend`
+ `id` 不采用 md5 编码的形式获得。

## 人数信息的实时更新 （完成）

### 注意事项

+ 增删改都需要重新核实人数信息
+ 每月例行一次信息核实

在下面这些函数里，添加一条命令即可。即
+ 增加一个人 (完成)
+ 删除一个人 (完成)
+ 批量导入一群人 (完成)
+ 批量退伍 (完成)
+ 批量重新分配 (完成)
+ 修改一个人的资料信息 (完成)

添加的命令为 *./common/models/Unit.php*

```php
    public static function refreshCountsAll()
    {
        $units = self::find()
            ->where(1)
            ->all();

        foreach($units as $unit){
            $unit->refreshCounts();
        }
    }

```

也即 `Unit::refreshCountsALL();`

## 周末和战备的自动跳转

### 功能设想

给定一个日期时间，则启动一个定时任务，到时间了，则执行该任务。然后根据是否定义了下次任务，决定重新修改本任务，还是删除本任务。

### 实现

最主要的是代码的实现


## 拼音方案

参考网页
+ https://github.com/overtrue/pinyin

已经安装，未使用

## 文件上传

参考网页
+ https://github.com/2amigos/yii2-file-upload-widget

已经安装，未使用

## 数据库转换

参考网页
+ https://dbconvert.com/mssql/mysql/
+ https://www.spectralcore.com/fullconvert

涉及到真实运行，需要讲原来的 MS SQL 2008 R2 数据库转换到 MySQL 中来，懒得自己一条条修改，策划使用已有软件来实现。

